<% content_for :title, "My Trips - TrailSync" %>

<div class="w-full">
  <!-- Header Section -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 mb-1">My Trips</h1>
      <p class="text-gray-600">Manage and track all your adventures</p>
    </div>
    <% if user_signed_in? %>
      <%= link_to new_trip_path, class: "mt-3 sm:mt-0 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition duration-300 flex items-center space-x-2", data: { turbo_frame: "new_trip_form" } do %>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        <span>New Trip</span>
      <% end %>
    <% else %>
      <%= link_to new_user_session_path, class: "mt-3 sm:mt-0 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition duration-300 flex items-center space-x-2" do %>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
        </svg>
        <span>Sign In to Create Trips</span>
      <% end %>
    <% end %>
  </div>

  <!-- New Trip Form Placeholder -->
  <%= turbo_frame_tag "new_trip_form" %>

  <% if @trips.any? %>
    <!-- Filter Tabs -->
    <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg mb-6 w-fit">
      <button onclick="filterTrips('all')" class="filter-btn active px-4 py-2 rounded-md font-medium transition duration-200">
        All Trips (<%= @trips.count %>)
      </button>
      <button onclick="filterTrips('upcoming')" class="filter-btn px-4 py-2 rounded-md font-medium transition duration-200">
        Upcoming (<%= @upcoming_trips.count %>)
      </button>
      <button onclick="filterTrips('past')" class="filter-btn px-4 py-2 rounded-md font-medium transition duration-200">
        Completed (<%= @past_trips.count %>)
      </button>
    </div>

    <!-- Trips Grid -->
    <%= turbo_frame_tag "trips_list" do %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="trips-container">
        <% @trips.each do |trip| %>
          <%= render "trip", trip: trip %>
        <% end %>
      </div>
    <% end %>

    <!-- Empty State for Filtered Results -->
    <div id="no-results" class="hidden text-center py-12">
      <div class="bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
      <h3 class="text-lg font-semibold text-gray-900 mb-2">No trips found</h3>
      <p class="text-gray-600">Try adjusting your filter or create a new trip.</p>
    </div>

  <% else %>
    <!-- Empty State -->
    <div class="text-center py-12">
      <div class="bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">No trips yet</h3>
      <p class="text-gray-600 mb-4 max-w-md mx-auto">Start planning your adventures! Create your first trip and begin tracking your journey.</p>
      <%= link_to new_trip_path, class: "bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition duration-300 inline-flex items-center space-x-2" do %>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        <span>Create Your First Trip</span>
      <% end %>
    </div>
  <% end %>
</div>

<script>
  function filterTrips(status) {
    const cards = document.querySelectorAll('.trip-card');
    const buttons = document.querySelectorAll('.filter-btn');
    const noResults = document.getElementById('no-results');
    let visibleCount = 0;

    // Update button states
    buttons.forEach(btn => btn.classList.remove('active', 'bg-white', 'text-blue-600', 'shadow-sm'));
    event.target.classList.add('active', 'bg-white', 'text-blue-600', 'shadow-sm');

    // Filter cards
    cards.forEach(card => {
      if (status === 'all' || card.dataset.status === status) {
        card.style.display = 'block';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });

    // Show/hide no results message
    if (visibleCount === 0) {
      noResults.classList.remove('hidden');
    } else {
      noResults.classList.add('hidden');
    }
  }

  // Initialize filter buttons
  document.addEventListener('DOMContentLoaded', function() {
    const activeBtn = document.querySelector('.filter-btn.active');
    if (activeBtn) {
      activeBtn.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
    }
  });
</script>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
